// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum UserRole {
  RESIDENT
  CAREGIVER
  ADMIN
}

model User {
  id           String        @id @default(uuid())
  name         String
  email        String?       @unique
  passwordHash String
  role         UserRole      @default(RESIDENT)
  homeFacility String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  profile      Profile?
  reminderLogs ReminderLog[]
}

model Profile {
  id             String          @id @default(uuid())
  user           User            @relation(fields: [userId], references: [id])
  userId         String          @unique
  age            Int
  conditions     Json
  residence      String?
  wakeTime       DateTime?
  bedTime        DateTime?
  meals          Json?
  favoriteGenres Json?
  favoriteSongs  Json?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  medications    Medication[]
  reminders      Reminder[]
  playback       PlaybackHistory[]
  playlist       PlaylistItem[]
}

model Medication {
  id             String    @id @default(uuid())
  profile        Profile   @relation(fields: [profileId], references: [id])
  profileId      String
  name           String
  dosage         String?
  instructions   String?
  preferredTime  DateTime?
  takeWithFood   Boolean   @default(false)
  notes          String?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  reminders      Reminder[]
}

model Reminder {
  id             String        @id @default(uuid())
  profile        Profile       @relation(fields: [profileId], references: [id])
  profileId      String
  medication     Medication?   @relation(fields: [medicationId], references: [id])
  medicationId   String?
  label          String
  scheduledAt    DateTime
  recurrence     String?
  snoozeMinutes  Int           @default(10)
  active         Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  logs           ReminderLog[]
}

model ReminderLog {
  id             String      @id @default(uuid())
  reminder       Reminder    @relation(fields: [reminderId], references: [id])
  reminderId     String
  triggeredAt    DateTime
  acknowledgedAt DateTime?
  action         ReminderAction?
  ackTimeMs      Int?
  user           User?       @relation(fields: [userId], references: [id])
  userId         String?
  notes          String?
  createdAt      DateTime    @default(now())
}

enum ReminderAction {
  CONFIRMED
  SNOOZED
}

model PlaylistItem {
  id        String   @id @default(uuid())
  profile   Profile  @relation(fields: [profileId], references: [id])
  profileId String
  title     String
  artist    String
  query     String
  provider  String   @default("YouTube")
  videoId   String?
  createdAt DateTime @default(now())
}

model PlaybackHistory {
  id         String   @id @default(uuid())
  profile    Profile  @relation(fields: [profileId], references: [id])
  profileId  String
  songTitle  String
  artist     String
  provider   String
  videoId    String?
  startedAt  DateTime @default(now())
  stoppedAt  DateTime?
}
